<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sharon Howard">
<meta name="dcterms.date" content="2021-05-15">

<title>Criminal Tattoos - Tidying Tattoos: Handling missing data and non-tidy columns</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Criminal Tattoos</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html">
 <span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources.html">
 <span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/CriminalTattoos"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/digipanoptic"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../blog.xml"><i class="bi bi-rss-fill" role="img" aria-label="RSS">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#what-is-tidy-data" id="toc-what-is-tidy-data" class="nav-link active" data-scroll-target="#what-is-tidy-data">What is “tidy data”?</a></li>
  <li><a href="#the-data" id="toc-the-data" class="nav-link" data-scroll-target="#the-data">The data</a></li>
  <li><a href="#missing-data" id="toc-missing-data" class="nav-link" data-scroll-target="#missing-data">Missing data</a>
  <ul class="collapse">
  <li><a href="#a-simple-case" id="toc-a-simple-case" class="nav-link" data-scroll-target="#a-simple-case">a simple case</a></li>
  <li><a href="#more-complex-cases" id="toc-more-complex-cases" class="nav-link" data-scroll-target="#more-complex-cases">more complex cases</a></li>
  </ul></li>
  <li><a href="#multiple-values-in-one-cell" id="toc-multiple-values-in-one-cell" class="nav-link" data-scroll-target="#multiple-values-in-one-cell">Multiple values in one cell</a>
  <ul class="collapse">
  <li><a href="#a-simple-case-1" id="toc-a-simple-case-1" class="nav-link" data-scroll-target="#a-simple-case-1">a simple case</a></li>
  <li><a href="#more-complex-cases-1" id="toc-more-complex-cases-1" class="nav-link" data-scroll-target="#more-complex-cases-1">more complex cases</a></li>
  </ul></li>
  <li><a href="#now-what" id="toc-now-what" class="nav-link" data-scroll-target="#now-what">Now what?</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Tidying Tattoos: Handling missing data and non-tidy columns</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Sharon Howard </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">15 May 2021</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="what-is-tidy-data" class="level2">
<h2 class="anchored" data-anchor-id="what-is-tidy-data">What is “tidy data”?</h2>
<p><a href="https://r4ds.had.co.nz/tidy-data.html">“Tidy” data</a> describes data that conforms to three rules:</p>
<ul>
<li>Each variable must have its own column.</li>
<li>Each observation must have its own row.</li>
<li>Each value must have its own cell.</li>
</ul>
<p>Data usually needs to be in a tidy format to work with R <a href="https://www.tidyverse.org/">Tidyverse</a> tools. But it isn’t necessarily the best format for data entry or storage, and very few real world datasets are tidy. So it’s almost always necessary to do some <em>tidying</em> as well as cleaning up more general messiness before being able to analyse data, and the Criminal Tattoos data is no exception. This post introduces just a couple of very common issues:</p>
<ul>
<li>cleaning: missing data, which can be encoded in varying ways</li>
<li>tidying: multiple values in a single cell</li>
</ul>
<p>I think this is also a good introduction to the <em>fluidity</em> of working with data in software like R. The same data can be easily reshaped in many ways, depending on the task in hand, and be manipulated several times in the course of the same analysis.</p>
</section>
<section id="the-data" class="level2">
<h2 class="anchored" data-anchor-id="the-data">The data</h2>
<p>Load the Tidyverse packages and the descriptions data file. (For more on both of these, <a href="https://criminaltattoos.github.io/post/2021/04/12/a-first-look-at-tattoos-in-the-digital-panopticon/">see this introductory post</a>.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>descriptions_data <span class="ot">&lt;-</span> </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"_data"</span>, <span class="st">"convict_descriptions.2020-12-17.csv"</span>), <span class="at">guess_max =</span> <span class="dv">100000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I don’t want all the stuff in the file, so I’ll slim it down a bit, to keep only descriptions that contain tattoos and the columns that I’ll be working with here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>tattoo_descriptions <span class="ot">&lt;-</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  descriptions_data <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hastattoo<span class="sc">==</span><span class="st">"y"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subrecordid, descyear, born, gender, designs, digest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="missing-data" class="level2">
<h2 class="anchored" data-anchor-id="missing-data">Missing data</h2>
<p>Summarising a variable often immediately highlights problems. In this case, missing description years (as well as birth years) are encoded as 0.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>tattoo_descriptions <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(descyear)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 125 × 2
   descyear     n
      &lt;dbl&gt; &lt;int&gt;
 1        0   279
 2     1793     1
 3     1796     1
 4     1797    11
 5     1798     1
 6     1801     1
 7     1804     1
 8     1806     2
 9     1808     2
10     1809     1
# … with 115 more rows</code></pre>
</div>
</div>
<p>R doesn’t know that 0 means “missing”; it just treats it as a number.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>tattoo_descriptions <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(descyear) <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>descyear, <span class="at">y=</span>n)) <span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/bad_line-1.png" class="img-fluid" alt="A line chart of tattoo description years which looks a bit weird because missing data has been encoded as 0." width="672"></p>
</div>
</div>
<p>I could just filter out 0s in a plot like this, but it’s better to convert them to “NA” from the start so R will handle them properly. There are several ways to do this.</p>
<section id="a-simple-case" class="level3">
<h3 class="anchored" data-anchor-id="a-simple-case">a simple case</h3>
<p>If you want to convert <em>every</em> 0 in your data to NA, <a href="https://dplyr.tidyverse.org/reference/na_if.html">na_if()</a> <del>is</del> used to be an easy and convenient option. (A recent software update outlawed this use of na_if(). Apparently it was unintended and “accidental”.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>tattoo_descriptions <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(descyear, born) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(descyear<span class="sc">==</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert 0s in both descyear and born to NA</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">descyear =</span> <span class="fu">na_if</span>(descyear, <span class="dv">0</span>), <span class="at">born=</span><span class="fu">na_if</span>(born, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 279 × 2
   descyear  born
      &lt;dbl&gt; &lt;dbl&gt;
 1       NA    NA
 2       NA    NA
 3       NA    NA
 4       NA    NA
 5       NA    NA
 6       NA    NA
 7       NA  1797
 8       NA    NA
 9       NA    NA
10       NA    NA
# … with 269 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># na_if(0)  # this is no longer permitted </span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># you could do this instead</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mutate(across(everything(), ~na_if(., 0)))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="more-complex-cases" class="level3">
<h3 class="anchored" data-anchor-id="more-complex-cases">more complex cases</h3>
<p>A smarter option is <a href="http://naniar.njtierney.com/articles/replace-with-na.html">replace_with_na()</a> (from the {naniar} package). With this, you can specify which columns need attention, and list several possible values that might need conversion to NA (common variants might include -99 or “unknown”).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>tattoo_descriptions <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(descyear, born, gender) <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(descyear<span class="sc">==</span><span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># replace only 0s in descyear with NA</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_with_na</span>(<span class="at">replace=</span><span class="fu">list</span>(<span class="at">descyear=</span><span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 279 × 3
   descyear  born gender
      &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; 
 1       NA     0 m     
 2       NA     0 m     
 3       NA     0 m     
 4       NA     0 m     
 5       NA     0 m     
 6       NA     0 m     
 7       NA  1797 m     
 8       NA     0 m     
 9       NA     0 m     
10       NA     0 m     
# … with 269 more rows</code></pre>
</div>
</div>
<p>What about gender? For some reason there are both “u” for unknown and NA in the data. (Admittedly, there are only two of them so I’d be inclined to just drop them in this case…)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>tattoo_descriptions <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  gender     n
  &lt;chr&gt;  &lt;int&gt;
1 f       3635
2 m      71811
3 u          1
4 &lt;NA&gt;       1</code></pre>
</div>
</div>
<p>I can fix several missing data issues in the same line of code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>tattoo_descriptions <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(descyear, born, gender) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gender<span class="sc">==</span><span class="st">"u"</span> <span class="sc">|</span> <span class="fu">is.na</span>(gender)) <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># replace 0s in descyear and born and "u" in gender with NA</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_with_na</span>(<span class="at">replace=</span><span class="fu">list</span>(<span class="at">descyear=</span><span class="dv">0</span>, <span class="at">born=</span><span class="dv">0</span>, <span class="at">gender=</span><span class="st">"u"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  descyear  born gender
     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; 
1     1881    NA &lt;NA&gt;  
2     1881  1837 &lt;NA&gt;  </code></pre>
</div>
</div>
<p>After the 0s have been replaced with NAs, the line chart drops the missing years automatically (I can suppress the warning message, if that’s the behaviour I want, or investigate further if it isn’t).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>tattoo_descriptions <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_with_na</span>(<span class="at">replace=</span><span class="fu">list</span>(<span class="at">descyear=</span><span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(descyear) <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>descyear, <span class="at">y=</span>n)) <span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/good_line-1.png" class="img-fluid" alt="The line chart of tattoo description years after converting 0 to NA, so they are dropped and a warning message is generated." width="672"></p>
</div>
</div>
</section>
</section>
<section id="multiple-values-in-one-cell" class="level2">
<h2 class="anchored" data-anchor-id="multiple-values-in-one-cell">Multiple values in one cell</h2>
<section id="a-simple-case-1" class="level3">
<h3 class="anchored" data-anchor-id="a-simple-case-1">a simple case</h3>
<p>The <code>designs</code> column contains all the tattoo designs identified in a description, separated with a “pipe” | symbol. This makes sense as a concise format for storing the data, but it’s not at all tidy or easy to work with.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>tattoo_descriptions <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(designs)) <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subrecordid, designs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 64,098 × 2
   subrecordid designs                                             
   &lt;chr&gt;       &lt;chr&gt;                                               
 1 cin77589    anchor|dog|moon|man and woman|diamond|half|sun|heart
 2 cin77592    anchor                                              
 3 cin77603    man and woman|crucifix|mermaid                      
 4 cin77604    dot                                                 
 5 cin77609    dot|ring                                            
 6 cin77616    sun moon and stars                                  
 7 cin77619    woman|flower pot                                    
 8 cin77622    figure|woman|shamrock|thistle                       
 9 cin77623    crown                                               
10 cin77626    ship|anchor|crown|thistle|ring|rose|mermaid         
# … with 64,088 more rows</code></pre>
</div>
</div>
<p>Again, I have more than one option for this.</p>
<p>One is a two-step process. First, <a href="https://stringr.tidyverse.org/reference/str_split.html">str_split()</a> splits up the string into pieces on each | symbol, putting them in a “list-column”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>tattoo_descriptions <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subrecordid, designs) <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(designs)) <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">design =</span> <span class="fu">str_split</span>(designs, <span class="st">"</span><span class="sc">\\</span><span class="st">|"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 64,098 × 3
   subrecordid designs                                              design   
   &lt;chr&gt;       &lt;chr&gt;                                                &lt;list&gt;   
 1 cin77589    anchor|dog|moon|man and woman|diamond|half|sun|heart &lt;chr [8]&gt;
 2 cin77592    anchor                                               &lt;chr [1]&gt;
 3 cin77603    man and woman|crucifix|mermaid                       &lt;chr [3]&gt;
 4 cin77604    dot                                                  &lt;chr [1]&gt;
 5 cin77609    dot|ring                                             &lt;chr [2]&gt;
 6 cin77616    sun moon and stars                                   &lt;chr [1]&gt;
 7 cin77619    woman|flower pot                                     &lt;chr [2]&gt;
 8 cin77622    figure|woman|shamrock|thistle                        &lt;chr [4]&gt;
 9 cin77623    crown                                                &lt;chr [1]&gt;
10 cin77626    ship|anchor|crown|thistle|ring|rose|mermaid          &lt;chr [7]&gt;
# … with 64,088 more rows</code></pre>
</div>
</div>
<p>Then <a href="https://tidyr.tidyverse.org/reference/nest.html">unnest()</a> is used to unpack each element of the list onto its own line.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>tattoo_descriptions_unnest <span class="ot">&lt;-</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>tattoo_descriptions <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(designs)) <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">design =</span> <span class="fu">str_split</span>(designs, <span class="st">"</span><span class="sc">\\</span><span class="st">|"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(design)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>tattoo_descriptions_unnest <span class="sc">%&gt;%</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subrecordid, design) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 176,777 × 2
   subrecordid design       
   &lt;chr&gt;       &lt;chr&gt;        
 1 cin77589    anchor       
 2 cin77589    dog          
 3 cin77589    moon         
 4 cin77589    man and woman
 5 cin77589    diamond      
 6 cin77589    half         
 7 cin77589    sun          
 8 cin77589    heart        
 9 cin77592    anchor       
10 cin77603    man and woman
# … with 176,767 more rows</code></pre>
</div>
</div>
<p>But in fact I find it easier to use <a href="https://juliasilge.github.io/tidytext/reference/unnest_tokens.html">unnest_tokens()</a> ({tidytext} package) to do this kind of task. It has more options for more complex cases, can be done in a single step, and is quicker.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>tattoo_descriptions_unnest_tokens <span class="ot">&lt;-</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>tattoo_descriptions <span class="sc">%&gt;%</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(designs)) <span class="sc">%&gt;%</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(design, designs, <span class="at">token=</span><span class="st">"regex"</span>, <span class="at">pattern=</span><span class="st">"</span><span class="sc">\\</span><span class="st">|"</span>, <span class="at">to_lower =</span> <span class="cn">FALSE</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>tattoo_descriptions_unnest_tokens <span class="sc">%&gt;%</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subrecordid, design) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 176,777 × 2
   subrecordid design       
   &lt;chr&gt;       &lt;chr&gt;        
 1 cin77589    anchor       
 2 cin77589    dog          
 3 cin77589    moon         
 4 cin77589    man and woman
 5 cin77589    diamond      
 6 cin77589    half         
 7 cin77589    sun          
 8 cin77589    heart        
 9 cin77592    anchor       
10 cin77603    man and woman
# … with 176,767 more rows</code></pre>
</div>
</div>
</section>
<section id="more-complex-cases-1" class="level3">
<h3 class="anchored" data-anchor-id="more-complex-cases-1">more complex cases</h3>
<p>The <code>digest</code> column is a considerably more complicated case. It contains what we called “body chunks” for each description - each body location identified as having at least one tattoo, followed by the list of tattoo terms. The format is <code>[body part : list|of|terms]</code>, with chunks separated by a space.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>tattoo_descriptions <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(digest) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 75,448 × 1
   digest                                                                       
   &lt;chr&gt;                                                                        
 1 [right arm : man and woman|sun|dog|ST|1838]  [left arm : half|moon|sun|ancho…
 2 [right arm : CPEP]  [right hand : JP]                                        
 3 [right arm : anchor|LARK]  [ : EM]                                           
 4 [left arm : TH]                                                              
 5 [right|shoulder : crucifix]  [right arm : man and woman]  [left arm : mermai…
 6 [right hanging body specifier|hand : dot|dot]                                
 7 [left hand : dot|ring]                                                       
 8 [left arm : MB]                                                              
 9 [left arm : sun moon and stars]                                              
10 [left hand : flower pot]  [right following body specifier : woman]           
# … with 75,438 more rows</code></pre>
</div>
</div>
<p>Three distinct steps are needed:</p>
<ul>
<li>put each chunk on its own line</li>
<li>separate body part and tattoos</li>
<li>put each tattoo on its own line</li>
</ul>
<p>For the first step, I’ll use <code>unnest_tokens</code> again, followed by <a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all()</a> to get rid of the square brackets.</p>
<p>(This needs a more advanced regex than the previous example; if you want to know more about how the regex works, try pasting the expression <code>(?=\[[^\]]+\]) *</code> into <a href="https://regexr.com/">here</a>.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>tattoo_chunks_unnest_tokens <span class="ot">&lt;-</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>tattoo_descriptions <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subrecordid, digest) <span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(chunk, digest, <span class="at">token=</span><span class="st">"regex"</span>, <span class="at">pattern=</span><span class="st">"(?=</span><span class="sc">\\</span><span class="st">[[^</span><span class="sc">\\</span><span class="st">]]+</span><span class="sc">\\</span><span class="st">]) *"</span>, <span class="at">to_lower =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chunk =</span> <span class="fu">str_remove_all</span>(chunk, <span class="st">"</span><span class="sc">\\</span><span class="st">[|</span><span class="sc">\\</span><span class="st">]"</span>))</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>tattoo_chunks_unnest_tokens</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 143,609 × 2
   subrecordid chunk                                              
   &lt;chr&gt;       &lt;chr&gt;                                              
 1 cin77589    "right arm : man and woman|sun|dog|ST|1838  "      
 2 cin77589    "left arm : half|moon|sun|anchor|heart|diamond|IMB"
 3 cin77590    "right arm : CPEP  "                               
 4 cin77590    "right hand : JP"                                  
 5 cin77592    "right arm : anchor|LARK  "                        
 6 cin77592    " : EM"                                            
 7 cin77598    "left arm : TH"                                    
 8 cin77603    "right|shoulder : crucifix  "                      
 9 cin77603    "right arm : man and woman  "                      
10 cin77603    "left arm : mermaid"                               
# … with 143,599 more rows</code></pre>
</div>
</div>
<p>Step two, splitting body part and tattoo terms into separate columns, uses the <a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>tattoo_chunks_unnest_tokens_separated <span class="ot">&lt;-</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>tattoo_chunks_unnest_tokens <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(chunk, <span class="at">into=</span><span class="fu">c</span>(<span class="st">"body"</span>, <span class="st">"tattoos"</span>), <span class="at">sep=</span><span class="st">" *: *"</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>tattoo_chunks_unnest_tokens_separated</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 143,609 × 3
   subrecordid body             tattoos                                 
   &lt;chr&gt;       &lt;chr&gt;            &lt;chr&gt;                                   
 1 cin77589    "right arm"      "man and woman|sun|dog|ST|1838  "       
 2 cin77589    "left arm"       "half|moon|sun|anchor|heart|diamond|IMB"
 3 cin77590    "right arm"      "CPEP  "                                
 4 cin77590    "right hand"     "JP"                                    
 5 cin77592    "right arm"      "anchor|LARK  "                         
 6 cin77592    ""               "EM"                                    
 7 cin77598    "left arm"       "TH"                                    
 8 cin77603    "right|shoulder" "crucifix  "                            
 9 cin77603    "right arm"      "man and woman  "                       
10 cin77603    "left arm"       "mermaid"                               
# … with 143,599 more rows</code></pre>
</div>
</div>
<p>Finally, to put each tattoo on its own line, I repeat the earlier step with <code>unnest_tokens</code>. The new output is a bit different from the first case because the digest includes everything identified as a tattoo, not just pictorial designs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>tattoo_chunks_tattoos_unnest_tokens <span class="ot">&lt;-</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>tattoo_chunks_unnest_tokens_separated <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(tattoo, tattoos, <span class="at">token=</span><span class="st">"regex"</span>, <span class="at">pattern=</span><span class="st">"</span><span class="sc">\\</span><span class="st">|"</span>, <span class="at">to_lower =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>tattoo_chunks_tattoos_unnest_tokens</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 343,417 × 3
   subrecordid body      tattoo         
   &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;          
 1 cin77589    right arm "man and woman"
 2 cin77589    right arm "sun"          
 3 cin77589    right arm "dog"          
 4 cin77589    right arm "ST"           
 5 cin77589    right arm "1838  "       
 6 cin77589    left arm  "half"         
 7 cin77589    left arm  "moon"         
 8 cin77589    left arm  "sun"          
 9 cin77589    left arm  "anchor"       
10 cin77589    left arm  "heart"        
# … with 343,407 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="now-what" class="level2">
<h2 class="anchored" data-anchor-id="now-what">Now what?</h2>
<p>Now I can have a lot more fun!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>tattoo_descriptions_unnest_tokens <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(design, <span class="at">sort=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">fct_reorder</span>(design, n), <span class="at">y=</span>n)) <span class="sc">+</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">"count"</span>, <span class="at">x=</span><span class="cn">NULL</span>, <span class="at">title=</span><span class="st">"Top ten tattoo designs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/top-ten-designs-1.png" class="img-fluid" alt="Horizontal bar chart of the ten most popular tattoo designs: dot, anchor, heart, ring, cross, woman, star, bracelet, clasped hands, sailor." width="672"></p>
</div>
</div>
<p>Which are the most popular body locations for tattoos? This needs more cleaning, but you get the gist.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>tattoo_chunks_unnest_tokens_separated <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">body =</span> <span class="fu">str_replace_all</span>(body, <span class="st">"</span><span class="sc">\\</span><span class="st">|"</span>, <span class="st">" "</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(body, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">fct_reorder</span>(body, n), <span class="at">y=</span>n)) <span class="sc">+</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">"count"</span>, <span class="at">x=</span><span class="cn">NULL</span>, <span class="at">title=</span><span class="st">"Top ten tattoo locations"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/top-ten-tattoo-locations-1.png" class="img-fluid" alt="Horizontal bar chart of the ten most popular body locations; needs more cleaning, but indicates that arms and hands are the most popular." width="672"></p>
</div>
</div>
<p>And here’s one I cleaned up earlier…</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/top-parts-top-terms-1.png" class="img-fluid" alt="Faceted horizontal bar charts of the most popular tattoo terms on the most popular body locations." width="672"></p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>